From: Mike Hommey <mh@glandium.org>
Date: Sat, 19 Feb 2011 10:38:14 +0100
Subject: Don't hardcode anything in application.ini files

https://bugzilla.mozilla.org/show_bug.cgi?id=525882
---
 browser/app/Makefile.in     |    7 +++++++
 browser/app/application.ini |    7 +++++--
 browser/confvars.sh         |    3 ++-
 config/autoconf.mk.in       |    3 +++
 configure.in                |   31 ++++++++++++++++++++++++++++++-
 5 files changed, 47 insertions(+), 4 deletions(-)

diff --git a/browser/app/Makefile.in b/browser/app/Makefile.in
index 31e8a77..8be20fa 100644
--- a/browser/app/Makefile.in
+++ b/browser/app/Makefile.in
@@ -77,6 +77,13 @@ ifdef SOURCE_REPO
 DEFINES += -DMOZ_SOURCE_REPO="$(SOURCE_REPO)"
 endif
 
+DEFINES += -DMOZ_APP_BASENAME="$(MOZ_APP_BASENAME)" \
+           -DMOZ_APP_VENDOR="$(MOZ_APP_VENDOR)"
+
+ifdef MOZ_APP_PROFILE
+DEFINES += -DMOZ_APP_PROFILE="$(MOZ_APP_PROFILE)"
+endif
+
 LIBS += $(JEMALLOC_LIBS)
 
 ifdef LIBXUL_SDK
diff --git a/browser/app/application.ini b/browser/app/application.ini
index 0f2cb3a..008b8c3 100644
--- a/browser/app/application.ini
+++ b/browser/app/application.ini
@@ -37,9 +37,12 @@
 
 #filter substitution
 [App]
-Vendor=Mozilla
-Name=Firefox
+Vendor=@MOZ_APP_VENDOR@
+Name=@MOZ_APP_BASENAME@
 Version=@APP_VERSION@
+#ifdef MOZ_APP_PROFILE
+Profile=@MOZ_APP_PROFILE@
+#endif
 BuildID=@GRE_BUILDID@
 #ifdef MOZ_SOURCE_REPO
 SourceRepository=@MOZ_SOURCE_REPO@
diff --git a/browser/confvars.sh b/browser/confvars.sh
index 2a957ff..ec5f06d 100755
--- a/browser/confvars.sh
+++ b/browser/confvars.sh
@@ -36,7 +36,8 @@
 #
 # ***** END LICENSE BLOCK *****
 
-MOZ_APP_NAME=firefox
+MOZ_APP_BASENAME=Firefox
+MOZ_APP_VENDOR=Mozilla
 MOZ_UPDATER=1
 MOZ_PHOENIX=1
 
diff --git a/config/autoconf.mk.in b/config/autoconf.mk.in
index 8b94e1e..fa3d30a 100644
--- a/config/autoconf.mk.in
+++ b/config/autoconf.mk.in
@@ -50,6 +50,9 @@ FIREFOX_VERSION	= @FIREFOX_VERSION@
 MOZ_BUILD_APP = @MOZ_BUILD_APP@
 MOZ_APP_NAME	= @MOZ_APP_NAME@
 MOZ_APP_DISPLAYNAME = @MOZ_APP_DISPLAYNAME@
+MOZ_APP_BASENAME = @MOZ_APP_BASENAME@
+MOZ_APP_VENDOR = @MOZ_APP_VENDOR@
+MOZ_APP_PROFILE = @MOZ_APP_PROFILE@
 MOZ_APP_UA_NAME = @MOZ_APP_UA_NAME@
 MOZ_APP_VERSION = @MOZ_APP_VERSION@
 MOZ_UA_FIREFOX_VERSION = @FIREFOX_VERSION@
diff --git a/configure.in b/configure.in
index 1251341..cb5dcf4 100644
--- a/configure.in
+++ b/configure.in
@@ -8390,7 +8390,7 @@ fi
 AC_SUBST(JS_SHARED_LIBRARY)
 
 if test -n "$MOZ_STATIC_BUILD_UNSUPPORTED" -a -n "$BUILD_STATIC_LIBS"; then
-  AC_MSG_ERROR([--enable-static is not supported for building $MOZ_APP_NAME.])
+  AC_MSG_ERROR([--enable-static is not supported for building $MOZ_BUILD_APP.])
 fi
 
 if test -n "$MOZ_ENABLE_LIBXUL" -a -n "$BUILD_STATIC_LIBS"; then
@@ -9109,8 +9109,37 @@ AC_SUBST(MOZ_POST_PROGRAM_COMMAND)
 AC_SUBST(MOZ_TIMELINE)
 AC_SUBST(OGLES_SDK_DIR)
 
+# The following variables are available to branding and application
+# configuration ($BRANDING/configure.sh and $APPLICATION/confvars.sh):
+# - MOZ_APP_VENDOR: Used for application.ini's "Vendor" field, which also
+# impacts profile location and user-visible fields.
+# - MOZ_APP_BASENAME: Typically stays consistent for multiple branded
+# versions of a given application (e.g. Minefield and Firefox both use
+# "Firefox"), but may vary for full rebrandings (e.g. Iceweasel). Used
+# for application.ini's "Name" field, which controls profile location in
+# the absence of a "Profile" field (see below), and various system
+# integration hooks (Unix remoting, Windows MessageWindow name, etc.)
+# - MOZ_APP_DISPLAYNAME: Used in user-visible fields (DLL properties,
+# Mac Bundle name, Updater, Installer), it is typically used for nightly
+# builds (e.g. Minefield for Firefox). Defaults to MOZ_APP_BASENAME if not
+# set.
+# - MOZ_APP_NAME: Used for e.g. the binary program file name. If not set,
+# defaults to a lowercase form of MOZ_APP_BASENAME.
+# - MOZ_APP_PROFILE: When set, used for application.ini's
+# "Profile" field, which controls profile location.
+
+if test -z "$MOZ_APP_NAME"; then
+   MOZ_APP_NAME=`echo $MOZ_APP_BASENAME | tr A-Z a-z`
+fi
+if test -z "$MOZ_APP_DISPLAYNAME"; then
+   MOZ_APP_DISPLAYNAME="$MOZ_APP_BASENAME"
+fi
+
 AC_SUBST(MOZ_APP_NAME)
 AC_SUBST(MOZ_APP_DISPLAYNAME)
+AC_SUBST(MOZ_APP_BASENAME)
+AC_SUBST(MOZ_APP_VENDOR)
+AC_SUBST(MOZ_APP_PROFILE)
 AC_DEFINE_UNQUOTED(MOZ_APP_UA_NAME, "$MOZ_APP_UA_NAME")
 AC_SUBST(MOZ_APP_UA_NAME)
 AC_DEFINE_UNQUOTED(MOZ_APP_UA_VERSION, "$MOZ_APP_VERSION")
