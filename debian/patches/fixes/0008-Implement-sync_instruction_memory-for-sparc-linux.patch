From e995f4282b0706a7c369cead33e5ad513a222b45 Mon Sep 17 00:00:00 2001
From: Mike Hommey <glandium@debian.org>
Date: Tue, 7 Jul 2009 22:09:19 +0200
Subject: [PATCH 08/30] Implement sync_instruction_memory for sparc linux

https://bugzilla.mozilla.org/show_bug.cgi?id=502369
---
 js/src/nanojit/Assembler.cpp |   12 ++++++++++++
 1 files changed, 12 insertions(+), 0 deletions(-)

diff --git a/js/src/nanojit/Assembler.cpp b/js/src/nanojit/Assembler.cpp
index 2727706..2727a14 100755
--- a/js/src/nanojit/Assembler.cpp
+++ b/js/src/nanojit/Assembler.cpp
@@ -50,8 +50,20 @@ extern "C" void __clear_cache(char *BEG, char *END);
 #endif
 
 #ifdef AVMPLUS_SPARC
+#ifdef __linux__
+void sync_instruction_memory(caddr_t v, u_int len)
+{
+	caddr_t end = v + len;
+	caddr_t p = v;
+	while (p < end) {
+		asm volatile("flush %0" : : "r" (p));
+		p += 32;
+	}
+}
+#else
 extern  "C"	void sync_instruction_memory(caddr_t v, u_int len);
 #endif
+#endif
 
 namespace nanojit
 {
-- 
1.7.0.rc0.69.g2ee80

