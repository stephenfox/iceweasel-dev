From: Mike Hommey <mh+mozilla@glandium.org>
Date: Sat, 23 Apr 2011 08:48:50 +0200
Subject: Bug 652139 - Use an integer type in
 DocumentViewerImpl::SetMinFontSize, instead of float. r=dbaron

---
 layout/base/nsDocumentViewer.cpp |   16 +++++++---------
 1 files changed, 7 insertions(+), 9 deletions(-)

diff --git a/layout/base/nsDocumentViewer.cpp b/layout/base/nsDocumentViewer.cpp
index d6a7e6e..23d004b 100644
--- a/layout/base/nsDocumentViewer.cpp
+++ b/layout/base/nsDocumentViewer.cpp
@@ -2753,8 +2753,7 @@ SetChildMinFontSize(nsIMarkupDocumentViewer* aChild, void* aClosure)
 {
   nsCOMPtr<nsIMarkupDocumentViewer_MOZILLA_2_0_BRANCH> branch =
     do_QueryInterface(aChild);
-  struct ZoomInfo* ZoomInfo = (struct ZoomInfo*) aClosure;
-  branch->SetMinFontSize(ZoomInfo->mZoom);
+  branch->SetMinFontSize(NS_PTR_TO_INT32(aClosure));
 }
 
 static void
@@ -2787,8 +2786,7 @@ SetExtResourceMinFontSize(nsIDocument* aDocument, void* aClosure)
   if (shell) {
     nsPresContext* ctxt = shell->GetPresContext();
     if (ctxt) {
-      struct ZoomInfo* ZoomInfo = static_cast<struct ZoomInfo*>(aClosure);
-      ctxt->SetMinFontSize(ZoomInfo->mZoom);
+      ctxt->SetMinFontSize(NS_PTR_TO_INT32(aClosure));
     }
   }
 
@@ -2867,8 +2865,7 @@ DocumentViewerImpl::SetMinFontSize(PRInt32 aMinFontSize)
   // change, our children's min font may be different, though it would be unusual).
   // Do this first, in case kids are auto-sizing and post reflow commands on
   // our presshell (which should be subsumed into our own style change reflow).
-  struct ZoomInfo ZoomInfo = { aMinFontSize };
-  CallChildren(SetChildMinFontSize, &ZoomInfo);
+  CallChildren(SetChildMinFontSize, NS_INT32_TO_PTR(aMinFontSize));
 
   // Now change our own min font
   nsPresContext* pc = GetPresContext();
@@ -2877,7 +2874,8 @@ DocumentViewerImpl::SetMinFontSize(PRInt32 aMinFontSize)
   }
 
   // And do the external resources
-  mDocument->EnumerateExternalResources(SetExtResourceMinFontSize, &ZoomInfo);
+  mDocument->EnumerateExternalResources(SetExtResourceMinFontSize,
+                                        NS_INT32_TO_PTR(aMinFontSize));
 
   batch.EndUpdateViewBatch(NS_VMREFRESH_NO_SYNC);
   
@@ -3112,7 +3110,7 @@ DocumentViewerImpl::SetHintCharacterSetSource(PRInt32 aHintCharacterSetSource)
   mHintCharsetSource = aHintCharacterSetSource;
   // now set the hint char set source on all children of mContainer
   CallChildren(SetChildHintCharacterSetSource,
-                      (void*) aHintCharacterSetSource);
+                      NS_INT32_TO_PTR(aHintCharacterSetSource));
   return NS_OK;
 }
 
@@ -3249,7 +3247,7 @@ NS_IMETHODIMP DocumentViewerImpl::SetBidiOptions(PRUint32 aBidiOptions)
     mPresContext->SetBidi(aBidiOptions, PR_TRUE); // could cause reflow
   }
   // now set bidi on all children of mContainer
-  CallChildren(SetChildBidiOptions, (void*) aBidiOptions);
+  CallChildren(SetChildBidiOptions, NS_INT32_TO_PTR(aBidiOptions));
   return NS_OK;
 }
 
